{%extends "base.html"%}

{%load static%}

{% block extra_styles %}
<link rel="stylesheet" type="text/css" href="{% static 'css/account/profile-view.css' %}">
<script src="https://kit.fontawesome.com/e48d166edc.js" crossorigin="anonymous"></script>
{% endblock %}

{%block content%}
{% for message in messages %}
    <div class="profile-view-{{ message.tags }}-container">
        <div class="profile-view-{{ message.tags }}-message">
            {{ message }}
        </div>
    </div>
{% endfor %}
<div class="profile-view">
    <h1 class="profile-view-title">Profile</h1>
    <div class="profile-view-main-container">
        <div class="profile-view-main-left">
            <div class="profile-view-main-left-account">
                <h1>Hi {{user.account.first_name}}!</h1>
                <p>{{ user.email }}</p>
                <p>{{ user.account.client_id }}</p>
                <p>{{ user.account.account_type_default }}
                {% if user.account.account %}
                <span><a href="#">EDIT ACCOUNT</a></span>
                {% else %}
                <span><a href="#">ADD ACCOUNT</a></span>
                {% endif %}
                </p>
                <p class="profile-view-main-change-password">
                    <button onclick="openPasswordBlock()">CHANGE PASSWORD</a></button>
                </p>
            </div>
            <div class="profile-view-main-left-image">
                <div class="profile-view-main-left-image-show">
                    {% if user.account.image %}
                    <img id="profileImage" src="{{ user.account.image.url }}" alt="Profile image" onclick="openImageBlock()">
                    {% else %}
                    <img id="profileImage" src="{% static 'images/no-image-account.webp' %}" alt="Profile image" onclick="openImageBlock()">
                    {% endif %}
                </div>
                <div class="profile-view-main-left-image-edit">
                    <img src="{% static 'images/edit-image-icon.svg' %}" onclick="openImageBlock()">
                </div>
            </div>
        </div>
        <div class="profile-view-main-right">
            <div class="profile-view-main-right-section">
                <div class="provile-view-main-right-counter">
                    <p>You are with us</p>
                    <p>x days x months x days</p>
                </div>
                <div class="profile-view-main-right-products">
                    <!--To do when products are added-->
                    <p>The list of recently purchased products</p>
                </div>
            </div>
        </div>
    </div>
    <div class="profile-view-personal-data-title">
        <h1 class="profile-view-title">Personal data</h1>
        <h1 class="profile-view-title">Home address</h1>
    </div>
    <div class="profile-view-personal-data-container">
        <div class="profile-view-account">
            <div class="profile-view-account-section">
                <h3 class="profile-view-account-title">USERNAME</h3>
                <p class="profile-view-account-field">{{ user.username }}</p>
            </div>
            <div class="profile-view-account-section">
                <h3 class="profile-view-account-title">NAME AND SURNAME</h3>
                <p class="profile-view-account-field">{{ user.account.get_full_name }}</p>
            </div>
            <div class="profile-view-account-section">
                <h3 class="profile-view-account-title">BIRTH DATE</h3>
                <p class="profile-view-account-field">{{ user.account.date_of_birth }}</p>
            </div>
            <div class="profile-view-account-section">
                <h3 class="profile-view-account-title">PHONE NUMBER</h3>
                <p class="profile-view-account-field">{{ user.account.phone }}</p>
            </div>
            <p class="profile-view-edit-account">
                <button onclick="openEditAccountBlock()">EDIT ACCOUNT</a></button>
            </p>
        </div>
        <div class="profile-view-home-address">
            <div class="profile-view-address-section">
                <h3 class="profile-view-address-title">STREET</h3>
                <p class="profile-view-address-field">{{ user.account.address.street }}</p>
            </div>
            <div class="profile-view-address-section">
                <h3 class="profile-view-address-title">ZIP CODE</h3>
                <p class="profile-view-address-field">{{ user.account.address.zip_code }}</p>
            </div>
            <div class="profile-view-address-section">
                <h3 class="profile-view-address-title">CITY</h3>
                <p class="profile-view-address-field">{{ user.account.address.city }}</p>
            </div>
            <div class="profile-view-address-section">
                <h3 class="profile-view-address-field">COUNTRY</h3>
                <p class="profile-view-address-field">{{ user.account.address.country }}</p>
            </div>
            <p class="profile-view-change-address">
                <button onclick="openChangeAddressBlock()">CHANGE ADDRESS</a></button>
            </p>
        </div>
    </div>
    <h1 class="profile-view-title">Shipping address</h1>
    <div class="profile-view-shipping-address-container">
        {% for address in shipping_addresses %}
        <div class="profile-view-shipping-address">
            <div class="profile-view-shipping-address-section">
                <h3 class="profile-view-shipping-address-title">STREET</h3>
                <p class="profile-view-shipping-address-field">{{ address.street }}</p>
            </div>
            <div class="profile-view-shipping-address-section">
                <h3 class="profile-view-shipping-address-title">ZIP CODE</h3>
                <p class="profile-view-shipping-address-field">{{ address.zip_code }}</p>
            </div>
            <div class="profile-view-shipping-address-section">
                <h3 class="profile-view-shipping-address-title">CITY</h3>
                <p class="profile-view-shipping-address-field">{{ address.city }}</p>
            </div>
            <div class="profile-view-shipping-address-section">
                <h3 class="profile-view-shipping-address-field">COUNTRY</h3>
                <p class="profile-view-shipping-address-field">{{ address.country }}</p>
            </div>
            <div class="profile-view-shipping-address-edit">
                <span><a href="{% url 'account:edit-shipping-address' request.user.username address.id 'edit' %}">EDIT</a></span>
                <span>
                    <form method="post" action="{% url 'account:edit-shipping-address' request.user.username address.id 'delete' %}">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="delete">
                        <button type="submit" onclick="return confirm('Are you sure you want to delete this address?')">DELETE</button>
                    </form>
                </span>
            </div>
        </div>
        {% endfor %}
        <div class="profile-view-shipping-address-add">
            <div class="profile-view-shipping-address-icon">
                <a href="{% url 'account:edit-shipping-address' request.user.username 'edit' %}"><i class="fas fa-plus"></i></a>
            </div>
        </div>
    </div>
</div>

<!-- edit profile image block -->
<div id="editImageBlock" class="edit-image-block-display">
    <h2>Change profile image</h2>
    <div id="editImageBlockContent" class="edit-image-block-content">
        <span class="close" onclick="closeImageBlock()">&times;</span>
        <div class="profile-view-image-edit">
            {% if user.account.image %}
            <img src="{{ user.account.image.url }}" alt="Profile image">
            {% else %}
            <img src="{% static 'images/no-image-account.webp' %}" alt="Profile image">
            {% endif %}
            <div id="uploadFilePreview" class="upload-file-preview"></div>
        </div>
        <div class="edit-image-form">
            <form id="uploadImageForm" class="edit-image-form" method="post" enctype="multipart/form-data" >
                <div class="image-form-field">
                    <div class="image-form-field-box">
                        <label for="uploadProfileImage" id="uploadFileLabel" class="file-input-label">
                            Choose File
                        </label>
                        {{ image_form.image }}
                    </div>
                    <input type="submit" class="profile-image-btn" value="Save image">
                </div>
                {%csrf_token%}
            </form>
        </div>
    </div>
</div>

<!-- change password block -->
<div id="changePasswordBlock" class="change-password-block-display">
    <h2>Change password</h2>
    <div id="changePasswordBlockContent" class="change-password-block-content">
        <span class="closet" onclick="closePasswordBlock()">&times;</span>
        <div class="change-password-form">
            <form method="post" action="{% url 'account:change-password' request.user.username %}">
                {% for field in password_form %}
                    {% for error in field.errors %}
                        <div class="change-password-error-message">{{ error }}</div>
                    {% endfor %}
                    <div class="change-password-box {% if field.errors %}has-error{% endif %}">
                        <label for="{{ field.id_for_label }}">{{ field.label }}:</label>
                        {{ field }}
                        <span class="change-password-help-text">{{ field.help_text }}</span>
                    </div>
                {% endfor %}
                {% csrf_token %}
                <button class="change-password-button" type="submit">Change Password</button>
            </form>
        </div>
    </div>
</div>

<!-- edit account block -->
<div id="editAccountBlock" class="edit-account-block-display">
    <h1>Edit your account</h1>
    <div id="editAccountBlockContent" class="edit-account-block-content">
        <span class="closet1" onclick="closeEditAccountBlock()">&times;</span>
        <div class="edit-account-form">
            <form method="post" action="{% url 'account:edit-account' request.user.username %}">
                {% for field in account_form %}
                {% for error in field.errors %}
                    <div class="edit-account-error-message">{{ error }}</div>
                {% endfor %}
                <div class="edit-account-box {% if field.errors %}has-error{% endif %}">
                    <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                    {{ field }}
                    <span class="edit-account-help-text">{{ field.help_text }}</span>
                </div>
                {% endfor %}
                {%csrf_token%}
                <button class="edit-account-button" type="submit">Save Changes</button>
            </form>
        </div>
    </div>
</div>

<!-- change address block -->
<div id="changeAddressBlock" class="change-address-block-display">
    <h1>Edit your address</h1>
    <div id="changeAddressBlockContent" class="change-address-block-content">
        <span class="closet2" onclick="closeChangeAddressBlock()">&times;</span>
        <div class="change-address-form">
            <form method="post" action="{% url 'account:edit-address' request.user.username %}">
                {% for field in address_form %}
                {% for error in field.errors %}
                    <div class="change-address-error-message">{{ error }}</div>
                {% endfor %}
                <div class="change-address-box {% if field.errors %}has-error{% endif %}">
                    <label for="{{ field.id_for_label }}">{{ field.label }}:</label>
                    {{ field }}
                    <span class="change-address-help-text">{{ field.help_text }}</span>
                </div>
                {% endfor %}
                {%csrf_token%}
                <button class="change-address-button" type="submit">Save Changes</button>
            </form>
        </div>
    </div>
</div>

<!-- overlay -->
<div id="overlay" class="block-overlay"></div>

{%endblock content%}

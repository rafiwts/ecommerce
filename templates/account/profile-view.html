{%extends "base.html"%}

{%load static%}

{% block extra_styles %}
<link rel="stylesheet" type="text/css" href="{% static 'css/account/profile-view.css' %}">
<script src="https://kit.fontawesome.com/e48d166edc.js" crossorigin="anonymous"></script>
{% endblock %}

{%block content%}
{% for message in messages %}
    <div class="profile-view-{{ message.tags }}-container">
        <div class="profile-view-{{ message.tags }}-message">
            {{ message }}
        </div>
    </div>
{% endfor %}
<div class="profile-view">
    <h1 class="profile-view-title">Profile</h1>
    <div class="profile-view-main-container">
        <div class="profile-view-main-left">
            <div class="profile-view-main-left-account">
                <h1>Hi {{user.account.first_name}}!</h1>
                <p>{{ user.email }}</p>
                <p>{{ user.account.client_id }}</p>
                <p>{{ user.account.account_type_default }}
                {% if user.account.account %}
                <span><a href="#">EDIT ACCOUNT</a></span>
                {% else %}
                <span><a href="#">ADD ACCOUNT</a></span>
                {% endif %}
                </p>
                <p class="profile-view-main-change-password">
                    <button onclick="(() => openBlock('changePasswordBlock'))()">CHANGE PASSWORD</a></button>
                </p>
            </div>
            <div class="profile-view-main-left-image">
                <div class="profile-view-main-left-image-show">
                    {% if user.account.image %}
                    <img id="profileImage" src="{{ user.account.image.url }}" alt="Profile image" onclick="openBlock('editImageBlock')">
                    {% else %}
                    <img id="profileImage" src="{% static 'images/no-image-account.webp' %}" alt="Profile image" onclick="openBlock('editImageBlock')">
                    {% endif %}
                </div>
                <div class="profile-view-main-left-image-edit">
                    <img src="{% static 'images/edit-image-icon.svg' %}" onclick="(() => openBlock('editImageBlock'))()">
                </div>
            </div>
        </div>
        <div class="profile-view-main-right">
            <div class="profile-view-main-right-section">
                <div class="provile-view-main-right-counter">
                    <p>You are with us</p>
                    <p>x days x months x days</p>
                </div>
                <div class="profile-view-main-right-products">
                    <!--To do when products are added-->
                    <p>The list of recently purchased products</p>
                </div>
            </div>
        </div>
    </div>
    <div class="profile-view-personal-data-title">
        <h1 class="profile-view-title">Personal data</h1>
        <h1 class="profile-view-title">Home address</h1>
    </div>
    <div class="profile-view-personal-data-container">
        <div class="profile-view-account">
            <div class="profile-view-account-section">
                <h3 class="profile-view-account-title">USERNAME</h3>
                <p class="profile-view-account-field">{{ user.username }}</p>
            </div>
            <div class="profile-view-account-section">
                <h3 class="profile-view-account-title">NAME AND SURNAME</h3>
                <p class="profile-view-account-field">{{ user.account.get_full_name }}</p>
            </div>
            <div class="profile-view-account-section">
                <h3 class="profile-view-account-title">BIRTH DATE</h3>
                <p class="profile-view-account-field">{{ user.account.date_of_birth }}</p>
            </div>
            <div class="profile-view-account-section">
                <h3 class="profile-view-account-title">PHONE NUMBER</h3>
                <p class="profile-view-account-field">{{ user.account.phone }}</p>
            </div>
            <div class="profile-view-account-section">
                <h3 class="profile-view-account-title">ACCOUNT</h3>
                <p class="profile-view-account-field">{{ user.account.account_type_default }}</p>
            </div>
            <p class="profile-view-edit-account">
                <button onclick="(() => openBlock('editAccountBlock'))()">EDIT ACCOUNT</a></button>
            </p>
        </div>
        <div class="profile-view-home-address">
            <div class="profile-view-address-section">
                <h3 class="profile-view-address-title">STREET</h3>
                <p class="profile-view-address-field">{{ user.account.address.street }}</p>
            </div>
            <div class="profile-view-address-section">
                <h3 class="profile-view-address-title">ZIP CODE</h3>
                <p class="profile-view-address-field">{{ user.account.address.zip_code }}</p>
            </div>
            <div class="profile-view-address-section">
                <h3 class="profile-view-address-title">CITY</h3>
                <p class="profile-view-address-field">{{ user.account.address.city }}</p>
            </div>
            <div class="profile-view-address-section">
                <h3 class="profile-view-address-title">STATE</h3>
                <p class="profile-view-address-field">{{ user.account.address.state }}</p>
            </div>
            <div class="profile-view-address-section">
                <h3 class="profile-view-address-field">COUNTRY</h3>
                <p class="profile-view-address-field">{{ user.account.address.country }}</p>
            </div>
            <p class="profile-view-change-address">
                <button onclick="(() => openBlock('editAddressBlock'))()">EDIT ADDRESS</a></button>
            </p>
        </div>
    </div>
    <h1 class="profile-view-title">Shipping address</h1>
    <div class="profile-view-shipping-address-container">
        {% for address in shipping_address_data %}
        <div class="profile-view-shipping-address">
            <div class="profile-view-shipping-address-section">
                <h3 class="profile-view-shipping-address-title">STREET {{ address.id }}</h3>
                <p class="profile-view-shipping-address-field">{{ address.street }}</p>
            </div>
            <div class="profile-view-shipping-address-section">
                <h3 class="profile-view-shipping-address-title">ZIP CODE</h3>
                <p class="profile-view-shipping-address-field">{{ address.zip_code }}</p>
            </div>
            <div class="profile-view-shipping-address-section">
                <h3 class="profile-view-shipping-address-title">CITY</h3>
                <p class="profile-view-shipping-address-field">{{ address.city }}</p>
            </div>
            <div class="profile-view-shipping-address-section">
                <h3 class="profile-view-shipping-address-field">STATE</h3>
                <p class="profile-view-shipping-address-field">{{ address.state }}</p>
            </div>
            <div class="profile-view-shipping-address-section">
                <h3 class="profile-view-shipping-address-field">COUNTRY</h3>
                <p class="profile-view-shipping-address-field">{{ address.country }}</p>
            </div>
            <div class="profile-view-shipping-address-edit">
                <button onclick="openEditShippingAddressBlock('editShippingAddressBlock-{{ address.id }}')">EDIT</a></span>
                <span>
                    <form method="post" action="{% url 'account:delete-shipping-address' request.user.username address.id %}">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="delete">
                        <button type="submit" onclick="return confirm('Are you sure you want to delete this address?')">DELETE</button>
                    </form>
                </span>
            </div>
        </div>
        {% endfor %}
        <div class="profile-view-shipping-address-add">
            <div class="profile-view-shipping-address-icon">
                <i onclick="(() => openBlock('addShippingAddressBlock'))()" class="fas fa-plus"></i></a>
            </div>
        </div>
    </div>
</div>

<!-- edit profile image block -->
<div id="editImageBlock" class="edit-image-block-display">
    <h2>Change profile image</h2>
    <div id="editImageBlockContent" class="edit-image-block-content">
        <span class="close" onclick="(() => closeBlock('editImageBlock'))()">&times;</span>
        <div class="profile-view-image-edit">
            {% if user.account.image %}
            <img src="{{ user.account.image.url }}" alt="Profile image">
            {% else %}
            <img src="{% static 'images/no-image-account.webp' %}" alt="Profile image">
            {% endif %}
            <div id="uploadFilePreview" class="upload-file-preview"></div>
        </div>
        <div class="edit-image-form">
            <form id="uploadImageForm" class="edit-image-form" action="{% url 'account:change-profile-image'%}" method="post" enctype="multipart/form-data" >
                <div class="image-form-field">
                    <div class="image-form-field-box">
                        <label for="uploadProfileImage" id="uploadFileLabel" class="file-input-label">
                            Choose File
                        </label>
                        {{ image_form.image }}
                    </div>
                    <input type="submit" class="profile-image-btn" value="Save image">
                </div>
                {%csrf_token%}
            </form>
        </div>
    </div>
</div>

<!-- change password block -->
<div id="changePasswordBlock" class="change-password-block-display">
    <h2>Change password</h2>
    <div id="changePasswordBlockContent" class="change-password-block-content">
        <span class="closet" onclick="(() => closeBlock('changePasswordBlock'))()">&times;</span>
        <div id="password-validation-msg" style="color: red;"></div>
        <div class="change-password-form">
            <form id="passwordForm" method="post" action="{% url 'account:change-password' request.user.username %}">
                {% for field in password_form %}
                    {% for error in field.errors %}
                        <div class="change-password-error-message">{{ error }}</div>
                    {% endfor %}
                    <div class="change-password-box {% if field.errors %}has-error{% endif %}">
                        <label for="{{ field.id_for_label }}">{{ field.label }}:</label>
                        {{ field }}
                        <span class="change-password-help-text">{{ field.help_text }}</span>
                    </div>
                {% endfor %}
                {% csrf_token %}
                <button class="change-password-button" type="submit">Change Password</button>
            </form>
        </div>
    </div>
</div>

<!-- edit account block -->
<div id="editAccountBlock" class="edit-account-block-display">
    <h1>Edit your account</h1>
    <div id="editAccountBlockContent" class="edit-account-block-content">
        <span class="closet1" onclick="(() => closeBlock('editAccountBlock'))()">&times;</span>
        <div class="edit-account-form">
            <form method="post" action="{% url 'account:edit-account' request.user.username %}">
                {% for field in account_form %}
                    {% for error in field.errors %}
                        <div class="edit-account-error-message">{{ error }}</div>
                    {% endfor %}
                    <div class="edit-account-box {% if field.errors %}has-error{% endif %}">
                        <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                        {{ field }}
                        <span class="edit-account-help-text">{{ field.help_text }}</span>
                    </div>
                    {% endfor %}
                    {%csrf_token%}
                <button class="edit-account-button" type="submit">Save Changes</button>
            </form>
        </div>
    </div>
</div>

<!-- edit address block -->
<div id="editAddressBlock" class="edit-address-block-display">
    <h1>Edit your address</h1>
    <div id="editAddressBlockContent" class="edit-address-block-content">
        <span class="closet2" onclick="(() => closeBlock('editAddressBlock'))()">&times;</span>
        <div id="edit-address-validation-msg" style="color: red;"></div>
        <div class="edit-address-form">
            <form id="editAddressForm" method="post" action="{% url 'account:edit-address' request.user.username %}">
                {% for field in address_form %}
                    {% for error in field.errors %}
                        <div class="edit-address-error-message">{{ error }}</div>
                    {% endfor %}
                    <div class="edit-address-box {% if field.errors %}has-error{% endif %}">
                        <label for="{{ field.id_for_label }}">{{ field.label }}:</label>
                        {{ field }}
                        <span class="edit-address-help-text">{{ field.help_text }}</span>
                    </div>
                    {% endfor %}
                    {%csrf_token%}
                <button class="edit-address-button" type="submit">Save Changes</button>
            </form>
        </div>
    </div>
</div>

<!-- add shipping address block -->
<div id="addShippingAddressBlock" class="add-shipping-address-block-display">
    <h1>Add shipping address</h1>
    <div id="addShippingAddressBlockContent" class="add-shipping-address-block-content">
        <span class="closet3" onclick="(() => closeBlock('addShippingAddressBlock'))()">&times;</span>
        <div class="add-shipping-address-form">
            <form method="post" action="{% url 'account:shipping-address-add' request.user.username %}">
                {% for field in shipping_address_form %}
                    {% for error in field.errors %}
                        <div class="add-shipping-address-error-message">{{ error }}</div>
                    {% endfor %}
                    <div class="add-shipping-address-box {% if field.errors %}has-error{% endif %}">
                        <label for="{{ field.id_for_label }}">{{ field.label }}:</label>
                        {{ field }}
                        <span class="change-password-help-text">{{ field.help_text }}</span>
                    </div>
                {% endfor %}
                {% csrf_token %}
                <button type="submit">Saved</button>
            </form>
        </div>
    </div>
</div>

<!-- edit shipping address block - create each form for each instance of shipping address -->
{% for address in shipping_address_data %}
<div id="editShippingAddressBlock-{{ address.id }}" class="edit-shipping-address-block-display">
    <h1>Edit shipping address {{ address.id }}</h1>
    <div id="editShippingAddressBlockContent" class="edit-shipping-address-block-content">
        <span class="closet4" onclick="closeEditShippingAddressBlock('editShippingAddressBlock-{{ address.id }}')">&times;</span>
        <div class="edit-shipping-address-form">
            <form method="post" action="{% url 'account:update-shipping-address' request.user.username address.id %}">
                <div class="edit-shipping-address-form-box">
                    <div class="edit-shipping-address-form-field street {% if shipping_address_form.street.errors %}has-error{% endif %}">
                        <div class="edit-shipping-address-form-field-box">
                            <h5>{{ shipping_address_form.street.label }}</h5>
                            <input type="text" name="{{ shipping_address_form.street.name }}" value="{{ address.street }}">
                        </div>
                    </div>
                    <div class="edit-shipping-address-form-field zip_code {% if shipping_address_form.zip_code.errors %}has-error{% endif %}">
                        <div class="edit-shipping-address-form-field-box">
                            <h5>{{ shipping_address_form.zip_code.label }}</h5>
                            <input type="text" name="{{ shipping_address_form.zip_code.name }}" value="{{ address.zip_code }}">
                        </div>
                    </div>
                    <div class="edit-shipping-address-form-field city {% if shipping_address_form.city.errors %}has-error{% endif %}">
                        <div class="edit-shipping-address-form-field-box">
                            <h5>{{ shipping_address_form.city.label }}</h5>
                            <input type="text" name="{{ shipping_address_form.city.name }}" value="{{ address.city }}">
                        </div>
                    </div>
                    <div class="edit-shipping-address-form-field state {% if shipping_address_form.state.errors %}has-error{% endif %}">
                        <div class="edit-shipping-address-form-field-box">
                            <h5>{{ shipping_address_form.state.label }}</h5>
                            <input type="text" name="{{ shipping_address_form.state.name }}" value="{{ address.state }}">
                        </div>
                    </div>
                    <div class="edit-shipping-address-form-field country {% if shipping_address_form.country.errors %}has-error{% endif %}">
                        <div class="edit-shipping-address-form-field-box">
                            <h5>{{ shipping_address_form.country.label }}</h5>
                            <input type="text" name="{{ shipping_address_form.country.name }}" value="{{ address.country }}">
                        </div>
                    </div>
                    {%csrf_token%}
                    <button type="submit">Saved</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endfor %}

<div id="overlay" class="block-overlay"></div>

{%endblock content%}
